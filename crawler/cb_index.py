# 抓取宁稳网的数据(每天中午, 下午收盘更新, 非实时, 但是最全)

from datetime import datetime

from crawler import crawler_utils
from crawler.crawler_utils import get_chrome_driver
from utils import db_utils

header = {
    "Referer": "http://www.ninwin.cn/index.php?m=profile",
    'User-Agent': "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36",
    # 'Cookie': "csrf_token=8919ea04925831e8; __51cke__=; P0s_winduser=RaqSRnBfFwDoLZv5tGFqXXLD4fXwVZQynHEOTJOsq1fzXIiXiCJW%2FWYIGis%3D; P0s_cbQuestion=1; __tins__4771153=%7B%22sid%22%3A%201631088120422%2C%20%22vd%22%3A%207%2C%20%22expires%22%3A%201631089976917%7D; __51laig__=234; PHPSESSID=jpl3tag9rff4l4mtdndsm36n44; P0s_visitor=Ncd58ncEEFs83Y9d2knG3OnEWpLyZm3YRPK8yFD6ja5fvV52; P0s_lastvisit=242%091631159109%09%2Findex.php%3Fm%3DmyAdmin%26c%3Dlog"
}


def get_content():
    # url = "https://www.jisilu.cn/data/cbnew/cb_index/"
    #
    # response = requests.get(url)
    # code = response.status_code
    # if code != 200:
    #     print("获取数据失败， 状态码：" + code)
    #
    # soup = bs4.BeautifulSoup(response.text, "html5lib")
    # table = soup.find_all('table')[1]
    # attr_id = table.attrs['id']
    # if 'table_cb_index' not in attr_id:
    #     print("table元素找的不对。id必须为cb_hq，实为：" + attr_id)
    #     return []
    # # 所有数据行 <tr>
    # trs = list(table.tbody.children)
    date = ['2017-12-29','2018-01-02','2018-01-03','2018-01-04','2018-01-05','2018-01-08','2018-01-09','2018-01-10','2018-01-11','2018-01-12','2018-01-15','2018-01-16','2018-01-17','2018-01-18','2018-01-19','2018-01-22','2018-01-23','2018-01-24','2018-01-25','2018-01-26','2018-01-29','2018-01-30','2018-01-31','2018-02-01','2018-02-02','2018-02-05','2018-02-06','2018-02-07','2018-02-08','2018-02-09','2018-02-12','2018-02-13','2018-02-14','2018-02-22','2018-02-23','2018-02-26','2018-02-27','2018-02-28','2018-03-01','2018-03-02','2018-03-05','2018-03-06','2018-03-07','2018-03-08','2018-03-09','2018-03-12','2018-03-13','2018-03-14','2018-03-15','2018-03-16','2018-03-19','2018-03-20','2018-03-21','2018-03-22','2018-03-23','2018-03-26','2018-03-27','2018-03-28','2018-03-29','2018-03-30','2018-04-02','2018-04-03','2018-04-04','2018-04-09','2018-04-10','2018-04-11','2018-04-12','2018-04-13','2018-04-16','2018-04-17','2018-04-18','2018-04-19','2018-04-20','2018-04-23','2018-04-24','2018-04-25','2018-04-26','2018-04-27','2018-05-02','2018-05-03','2018-05-04','2018-05-07','2018-05-08','2018-05-09','2018-05-10','2018-05-11','2018-05-14','2018-05-15','2018-05-16','2018-05-17','2018-05-18','2018-05-21','2018-05-22','2018-05-23','2018-05-24','2018-05-25','2018-05-28','2018-05-29','2018-05-30','2018-05-31','2018-06-01','2018-06-04','2018-06-05','2018-06-06','2018-06-07','2018-06-08','2018-06-11','2018-06-12','2018-06-13','2018-06-14','2018-06-15','2018-06-19','2018-06-20','2018-06-21','2018-06-22','2018-06-25','2018-06-26','2018-06-27','2018-06-28','2018-06-29','2018-07-02','2018-07-03','2018-07-04','2018-07-05','2018-07-06','2018-07-09','2018-07-10','2018-07-11','2018-07-12','2018-07-13','2018-07-16','2018-07-17','2018-07-18','2018-07-19','2018-07-20','2018-07-23','2018-07-24','2018-07-25','2018-07-26','2018-07-27','2018-07-30','2018-07-31','2018-08-01','2018-08-02','2018-08-03','2018-08-06','2018-08-07','2018-08-08','2018-08-09','2018-08-10','2018-08-13','2018-08-14','2018-08-15','2018-08-16','2018-08-17','2018-08-20','2018-08-21','2018-08-22','2018-08-23','2018-08-24','2018-08-27','2018-08-28','2018-08-29','2018-08-30','2018-08-31','2018-09-03','2018-09-04','2018-09-05','2018-09-06','2018-09-07','2018-09-10','2018-09-11','2018-09-12','2018-09-13','2018-09-14','2018-09-17','2018-09-18','2018-09-19','2018-09-20','2018-09-21','2018-09-25','2018-09-26','2018-09-27','2018-09-28','2018-10-08','2018-10-09','2018-10-10','2018-10-11','2018-10-12','2018-10-15','2018-10-16','2018-10-17','2018-10-18','2018-10-19','2018-10-22','2018-10-23','2018-10-24','2018-10-25','2018-10-26','2018-10-29','2018-10-30','2018-10-31','2018-11-01','2018-11-02','2018-11-05','2018-11-06','2018-11-07','2018-11-08','2018-11-09','2018-11-12','2018-11-13','2018-11-14','2018-11-15','2018-11-16','2018-11-19','2018-11-20','2018-11-21','2018-11-22','2018-11-23','2018-11-26','2018-11-27','2018-11-28','2018-11-29','2018-11-30','2018-12-03','2018-12-04','2018-12-05','2018-12-06','2018-12-07','2018-12-10','2018-12-11','2018-12-12','2018-12-13','2018-12-14','2018-12-17','2018-12-18','2018-12-19','2018-12-20','2018-12-21','2018-12-24','2018-12-25','2018-12-26','2018-12-27','2018-12-28','2019-01-02','2019-01-03','2019-01-04','2019-01-07','2019-01-08','2019-01-09','2019-01-10','2019-01-11','2019-01-14','2019-01-15','2019-01-16','2019-01-17','2019-01-18','2019-01-21','2019-01-22','2019-01-23','2019-01-24','2019-01-25','2019-01-28','2019-01-29','2019-01-30','2019-01-31','2019-02-01','2019-02-11','2019-02-12','2019-02-13','2019-02-14','2019-02-15','2019-02-18','2019-02-19','2019-02-20','2019-02-21','2019-02-22','2019-02-25','2019-02-26','2019-02-27','2019-02-28','2019-03-01','2019-03-04','2019-03-05','2019-03-06','2019-03-07','2019-03-08','2019-03-11','2019-03-12','2019-03-13','2019-03-14','2019-03-15','2019-03-18','2019-03-19','2019-03-20','2019-03-21','2019-03-22','2019-03-25','2019-03-26','2019-03-27','2019-03-28','2019-03-29','2019-04-01','2019-04-02','2019-04-03','2019-04-04','2019-04-08','2019-04-09','2019-04-10','2019-04-11','2019-04-12','2019-04-15','2019-04-16','2019-04-17','2019-04-18','2019-04-19','2019-04-22','2019-04-23','2019-04-24','2019-04-25','2019-04-26','2019-04-29','2019-04-30','2019-05-06','2019-05-07','2019-05-08','2019-05-09','2019-05-10','2019-05-13','2019-05-14','2019-05-15','2019-05-16','2019-05-17','2019-05-20','2019-05-21','2019-05-22','2019-05-23','2019-05-24','2019-05-27','2019-05-28','2019-05-29','2019-05-30','2019-05-31','2019-06-03','2019-06-04','2019-06-05','2019-06-06','2019-06-10','2019-06-11','2019-06-12','2019-06-13','2019-06-14','2019-06-17','2019-06-18','2019-06-19','2019-06-20','2019-06-21','2019-06-24','2019-06-25','2019-06-26','2019-06-27','2019-06-28','2019-07-01','2019-07-02','2019-07-03','2019-07-04','2019-07-05','2019-07-08','2019-07-09','2019-07-10','2019-07-11','2019-07-12','2019-07-15','2019-07-16','2019-07-17','2019-07-18','2019-07-19','2019-07-22','2019-07-23','2019-07-24','2019-07-25','2019-07-26','2019-07-29','2019-07-30','2019-07-31','2019-08-01','2019-08-02','2019-08-05','2019-08-06','2019-08-07','2019-08-08','2019-08-09','2019-08-12','2019-08-13','2019-08-14','2019-08-15','2019-08-16','2019-08-19','2019-08-20','2019-08-21','2019-08-22','2019-08-23','2019-08-26','2019-08-27','2019-08-28','2019-08-29','2019-08-30','2019-09-02','2019-09-03','2019-09-04','2019-09-05','2019-09-06','2019-09-09','2019-09-10','2019-09-11','2019-09-12','2019-09-16','2019-09-17','2019-09-18','2019-09-19','2019-09-20','2019-09-23','2019-09-24','2019-09-25','2019-09-26','2019-09-27','2019-09-30','2019-10-08','2019-10-09','2019-10-10','2019-10-11','2019-10-14','2019-10-15','2019-10-16','2019-10-17','2019-10-18','2019-10-21','2019-10-22','2019-10-23','2019-10-24','2019-10-25','2019-10-28','2019-10-29','2019-10-30','2019-10-31','2019-11-01','2019-11-04','2019-11-05','2019-11-06','2019-11-07','2019-11-08','2019-11-11','2019-11-12','2019-11-13','2019-11-14','2019-11-15','2019-11-18','2019-11-19','2019-11-20','2019-11-21','2019-11-22','2019-11-25','2019-11-26','2019-11-27','2019-11-28','2019-11-29','2019-12-02','2019-12-03','2019-12-04','2019-12-05','2019-12-06','2019-12-09','2019-12-10','2019-12-11','2019-12-12','2019-12-13','2019-12-16','2019-12-17','2019-12-18','2019-12-19','2019-12-20','2019-12-23','2019-12-24','2019-12-25','2019-12-26','2019-12-27','2019-12-30','2019-12-31','2020-01-02','2020-01-03','2020-01-06','2020-01-07','2020-01-08','2020-01-09','2020-01-10','2020-01-13','2020-01-14','2020-01-15','2020-01-16','2020-01-17','2020-01-20','2020-01-21','2020-01-22','2020-01-23','2020-02-03','2020-02-04','2020-02-05','2020-02-06','2020-02-07','2020-02-10','2020-02-11','2020-02-12','2020-02-13','2020-02-14','2020-02-17','2020-02-18','2020-02-19','2020-02-20','2020-02-21','2020-02-24','2020-02-25','2020-02-26','2020-02-27','2020-02-28','2020-03-02','2020-03-03','2020-03-04','2020-03-05','2020-03-06','2020-03-09','2020-03-10','2020-03-11','2020-03-12','2020-03-13','2020-03-16','2020-03-17','2020-03-18','2020-03-19','2020-03-20','2020-03-23','2020-03-24','2020-03-25','2020-03-26','2020-03-27','2020-03-30','2020-03-31','2020-04-01','2020-04-02','2020-04-03','2020-04-07','2020-04-08','2020-04-09','2020-04-10','2020-04-13','2020-04-14','2020-04-15','2020-04-16','2020-04-17','2020-04-20','2020-04-21','2020-04-22','2020-04-23','2020-04-24','2020-04-27','2020-04-28','2020-04-29','2020-04-30','2020-05-06','2020-05-07','2020-05-08','2020-05-11','2020-05-12','2020-05-13','2020-05-14','2020-05-15','2020-05-18','2020-05-19','2020-05-20','2020-05-21','2020-05-22','2020-05-25','2020-05-26','2020-05-27','2020-05-28','2020-05-29','2020-06-01','2020-06-02','2020-06-03','2020-06-04','2020-06-05','2020-06-08','2020-06-09','2020-06-10','2020-06-11','2020-06-12','2020-06-15','2020-06-16','2020-06-17','2020-06-18','2020-06-19','2020-06-22','2020-06-23','2020-06-24','2020-06-29','2020-06-30','2020-07-01','2020-07-02','2020-07-03','2020-07-06','2020-07-07','2020-07-08','2020-07-09','2020-07-10','2020-07-13','2020-07-14','2020-07-15','2020-07-16','2020-07-17','2020-07-20','2020-07-21','2020-07-22','2020-07-23','2020-07-24','2020-07-27','2020-07-28','2020-07-29','2020-07-30','2020-07-31','2020-08-03','2020-08-04','2020-08-05','2020-08-06','2020-08-07','2020-08-10','2020-08-11','2020-08-12','2020-08-13','2020-08-14','2020-08-17','2020-08-18','2020-08-19','2020-08-20','2020-08-21','2020-08-24','2020-08-25','2020-08-26','2020-08-27','2020-08-28','2020-08-31','2020-09-01','2020-09-02','2020-09-03','2020-09-04','2020-09-07','2020-09-08','2020-09-09','2020-09-10','2020-09-11','2020-09-14','2020-09-15','2020-09-16','2020-09-17','2020-09-18','2020-09-21','2020-09-22','2020-09-23','2020-09-24','2020-09-25','2020-09-28','2020-09-29','2020-09-30','2020-10-09','2020-10-12','2020-10-13','2020-10-14','2020-10-15','2020-10-16','2020-10-19','2020-10-20','2020-10-21','2020-10-22','2020-10-23','2020-10-26','2020-10-27','2020-10-28','2020-10-29','2020-10-30','2020-11-02','2020-11-03','2020-11-04','2020-11-05','2020-11-06','2020-11-09','2020-11-10','2020-11-11','2020-11-12','2020-11-13','2020-11-16','2020-11-17','2020-11-18','2020-11-19','2020-11-20','2020-11-23','2020-11-24','2020-11-25','2020-11-26','2020-11-27','2020-11-30','2020-12-01','2020-12-02','2020-12-03','2020-12-04','2020-12-07','2020-12-08','2020-12-09','2020-12-10','2020-12-11','2020-12-14','2020-12-15','2020-12-16','2020-12-17','2020-12-18','2020-12-21','2020-12-22','2020-12-23','2020-12-24','2020-12-25','2020-12-28','2020-12-29','2020-12-30','2020-12-31','2021-01-04','2021-01-05','2021-01-06','2021-01-07','2021-01-08','2021-01-11','2021-01-12','2021-01-13','2021-01-14','2021-01-15','2021-01-18','2021-01-19','2021-01-20','2021-01-21','2021-01-22','2021-01-25','2021-01-26','2021-01-27','2021-01-28','2021-01-29','2021-02-01','2021-02-02','2021-02-03','2021-02-04','2021-02-05','2021-02-08','2021-02-09','2021-02-10','2021-02-18','2021-02-19','2021-02-22','2021-02-23','2021-02-24','2021-02-25','2021-02-26','2021-03-01','2021-03-02','2021-03-03','2021-03-04','2021-03-05','2021-03-08','2021-03-09','2021-03-10','2021-03-11','2021-03-12','2021-03-15','2021-03-16','2021-03-17','2021-03-18','2021-03-19','2021-03-22','2021-03-23','2021-03-24','2021-03-25','2021-03-26','2021-03-29','2021-03-30','2021-03-31','2021-04-01','2021-04-02','2021-04-06','2021-04-07','2021-04-08','2021-04-09','2021-04-12','2021-04-13','2021-04-14','2021-04-15','2021-04-16','2021-04-19','2021-04-20','2021-04-21','2021-04-22','2021-04-23','2021-04-26','2021-04-27','2021-04-28','2021-04-29','2021-04-30','2021-05-06','2021-05-07','2021-05-10','2021-05-11','2021-05-12','2021-05-13','2021-05-14','2021-05-17','2021-05-18','2021-05-19','2021-05-20','2021-05-21','2021-05-24','2021-05-25','2021-05-26','2021-05-27','2021-05-28','2021-05-31','2021-06-01','2021-06-02','2021-06-03','2021-06-04','2021-06-07','2021-06-08','2021-06-09','2021-06-10','2021-06-11','2021-06-15','2021-06-16','2021-06-17','2021-06-18','2021-06-21','2021-06-22','2021-06-23','2021-06-24','2021-06-25','2021-06-28','2021-06-29','2021-06-30','2021-07-01','2021-07-02','2021-07-05','2021-07-06','2021-07-07','2021-07-08','2021-07-09','2021-07-12','2021-07-13','2021-07-14','2021-07-15','2021-07-16','2021-07-19','2021-07-20','2021-07-21','2021-07-22','2021-07-23','2021-07-26','2021-07-27','2021-07-28','2021-07-29','2021-07-30','2021-08-02','2021-08-03','2021-08-04','2021-08-05','2021-08-06','2021-08-09','2021-08-10','2021-08-11','2021-08-12','2021-08-13','2021-08-16','2021-08-17','2021-08-18','2021-08-19','2021-08-20','2021-08-23','2021-08-24','2021-08-25','2021-08-26','2021-08-27','2021-08-30','2021-08-31','2021-09-01','2021-09-02','2021-09-03','2021-09-06','2021-09-07','2021-09-08','2021-09-09','2021-09-10','2021-09-13','2021-09-14','2021-09-15','2021-09-16','2021-09-17','2021-09-22','2021-09-23','2021-09-24','2021-09-27','2021-09-28','2021-09-29','2021-09-30','2021-10-08','2021-10-11','2021-10-12','2021-10-13','2021-10-14','2021-10-15','2021-10-18','2021-10-19','2021-10-20','2021-10-21','2021-10-22','2021-10-25','2021-10-26','2021-10-27','2021-10-28','2021-10-29','2021-11-01','2021-11-02','2021-11-03','2021-11-04','2021-11-05']

    mid_price = [104.111,104.800,105.210,104.655,107.000,107.805,106.371,105.750,106.080,105.836,104.145,103.720,104.176,104.350,104.510,105.740,106.271,106.710,107.322,106.195,104.968,105.500,105.140,103.846,103.760,103.630,102.084,102.000,102.391,101.980,103.910,103.920,104.200,104.429,104.110,105.725,105.845,105.771,106.030,105.615,105.250,105.725,106.000,105.835,105.875,107.065,107.237,106.685,106.700,105.820,106.598,105.760,106.000,106.130,104.780,105.155,106.035,105.400,105.200,105.800,105.800,105.728,105.470,105.990,105.725,105.992,106.139,105.829,105.213,104.805,105.170,106.000,104.230,103.870,104.590,105.030,103.205,103.505,103.235,103.845,104.379,104.850,104.995,104.815,104.780,104.620,104.475,104.645,104.730,104.820,104.690,105.360,105.245,105.100,104.670,104.150,103.760,103.420,101.770,102.220,102.000,101.040,101.645,102.070,102.200,101.510,101.000,101.100,101.392,100.386,99.865,96.420,97.100,96.345,96.094,97.280,97.250,96.699,96.560,97.938,97.164,97.965,97.855,97.445,97.740,98.700,99.300,98.125,99.975,100.660,99.615,99.905,99.915,100.025,100.178,100.238,101.020,100.560,99.940,99.745,99.395,99.250,99.444,98.470,98.000,97.890,98.580,98.580,99.640,99.385,99.480,99.200,98.740,97.921,97.320,97.950,98.170,97.595,98.015,97.620,98.880,98.970,98.600,98.458,98.032,97.915,98.070,97.803,97.706,97.745,97.260,97.275,97.345,97.390,97.120,96.747,96.861,97.015,97.070,97.489,97.510,97.578,97.002,97.475,96.553,96.558,96.480,94.420,94.600,94.180,93.750,93.790,93.132,93.510,95.299,94.764,94.800,94.510,95.002,94.450,94.490,94.888,95.250,96.399,96.780,96.300,96.600,96.353,96.200,96.671,97.206,97.940,98.205,99.180,99.361,98.540,98.482,98.500,97.445,97.450,97.670,98.300,97.720,97.715,98.910,99.370,99.239,98.890,98.840,98.595,98.660,98.850,99.300,99.100,98.600,98.490,98.295,98.090,97.626,97.761,97.505,97.300,97.510,97.602,97.210,97.060,97.770,98.500,98.451,99.545,99.800,99.810,99.911,100.425,100.510,99.964,100.267,100.500,100.230,100.240,100.365,101.125,100.735,100.490,100.205,100.070,100.910,102.010,102.660,103.500,104.010,104.329,105.610,105.810,105.840,106.070,107.146,109.990,109.450,109.600,109.600,110.201,111.000,112.340,113.350,113.220,112.255,114.550,115.490,113.615,111.571,112.299,114.660,116.200,115.760,116.571,116.856,115.000,113.005,112.625,112.690,114.010,117.310,118.100,118.432,119.406,119.600,118.988,118.300,116.275,116.145,114.950,114.919,114.874,115.030,115.295,114.130,113.000,112.260,109.685,108.981,107.140,108.140,104.790,105.447,105.830,105.555,107.508,107.099,107.250,108.220,109.350,106.750,106.056,106.895,106.905,106.080,105.952,106.251,106.294,105.990,105.031,104.635,103.750,102.990,102.969,101.890,102.371,104.235,104.200,104.120,103.399,103.030,102.670,103.025,104.630,105.815,105.710,105.500,105.580,106.115,105.525,106.794,107.290,107.085,107.130,107.137,105.880,105.975,105.801,105.660,105.855,105.875,106.283,106.429,106.051,106.126,105.230,105.255,105.550,105.940,106.880,107.170,107.435,107.510,107.100,106.660,106.010,105.550,105.785,105.765,105.830,106.206,106.085,106.020,106.070,106.150,107.596,107.774,107.700,107.490,107.793,107.870,108.170,108.620,108.500,108.000,108.300,108.350,108.520,109.800,110.010,110.960,111.226,110.960,110.660,110.410,109.065,109.230,109.501,109.800,109.350,109.730,109.568,108.550,109.231,108.844,109.036,109.099,110.000,110.135,110.881,110.580,110.290,110.300,109.808,108.851,109.175,109.228,109.005,109.563,110.160,109.700,108.826,108.317,108.545,108.425,108.678,108.723,108.900,109.057,108.300,108.157,108.250,108.300,107.700,108.180,108.810,108.850,108.362,108.050,108.309,108.030,108.500,108.225,107.800,107.800,108.070,108.418,108.601,108.983,109.185,109.950,110.130,110.060,110.772,112.348,113.110,113.496,113.255,113.260,112.289,113.100,113.093,113.933,113.750,114.845,116.250,116.770,117.000,117.470,118.000,117.210,117.980,117.690,118.000,118.800,118.350,117.675,117.434,117.900,117.820,117.856,116.140,110.861,113.500,115.000,115.700,115.689,115.440,115.810,116.710,115.995,116.785,118.901,119.050,119.763,121.250,121.830,122.850,122.996,121.498,121.330,118.061,119.847,120.280,120.870,123.000,123.020,120.001,121.300,121.545,119.895,118.950,116.060,116.310,116.200,116.100,118.635,115.504,117.415,119.335,118.600,118.000,117.365,117.510,117.710,117.695,116.530,117.300,117.380,117.116,115.200,114.000,115.150,116.000,116.100,116.560,116.765,116.287,117.090,117.220,115.900,116.600,116.180,116.240,116.580,117.010,115.979,116.521,116.319,115.980,115.540,114.809,114.600,112.890,113.000,111.495,110.960,110.095,109.900,110.707,110.955,111.045,111.900,113.570,114.177,113.945,113.358,113.021,112.903,113.010,112.578,112.150,112.502,112.775,113.253,113.353,113.260,113.545,113.510,112.945,113.100,112.821,112.760,113.440,115.235,116.370,119.795,120.020,121.740,123.170,121.861,124.600,124.130,122.000,118.000,118.299,122.070,121.640,123.200,122.605,119.840,119.020,120.000,121.000,121.880,122.010,124.290,123.215,124.000,124.290,123.050,124.650,123.700,122.000,121.575,122.176,123.575,124.000,123.390,122.336,122.355,122.553,122.475,120.495,120.705,121.436,122.252,123.229,123.495,123.080,122.605,121.300,121.500,120.100,118.350,118.925,119.165,119.000,118.020,118.500,119.170,118.930,118.365,118.600,116.856,116.050,114.340,115.726,115.949,117.406,119.440,119.540,119.617,119.375,119.805,118.965,119.750,119.499,121.440,119.485,120.165,121.255,121.150,121.013,119.090,117.300,117.404,117.443,117.859,117.675,119.000,118.690,118.672,118.475,119.000,119.008,117.565,118.040,118.300,118.035,118.470,119.200,119.010,117.998,117.990,117.949,118.380,118.050,118.900,118.500,118.225,117.860,117.000,116.528,115.040,115.210,113.642,113.002,112.672,112.430,113.105,112.270,111.744,110.010,110.050,109.354,109.811,110.199,111.535,112.465,112.000,111.605,109.160,109.430,108.405,108.905,107.987,108.634,109.235,110.310,110.300,110.127,110.750,110.140,109.075,108.100,107.010,106.320,104.521,104.040,103.995,103.000,101.585,100.690,100.560,101.985,103.070,104.517,106.103,106.770,106.635,106.320,105.500,105.371,106.240,105.394,106.500,105.955,106.330,106.028,105.322,105.880,106.557,107.000,107.425,107.763,107.710,107.430,107.500,108.440,107.630,107.010,106.655,107.050,107.025,106.502,106.770,107.475,107.000,107.750,108.020,107.851,107.820,107.206,106.858,107.035,107.125,107.450,108.413,108.607,108.510,108.490,108.199,108.238,107.865,108.050,107.655,107.896,108.131,107.759,108.189,109.442,109.340,109.300,109.328,109.289,109.595,109.660,109.880,109.860,110.332,110.790,111.300,111.721,111.110,111.700,111.586,112.071,112.480,112.490,112.130,112.500,112.610,112.771,113.032,111.902,111.600,110.790,110.775,111.380,112.810,113.078,112.771,112.825,112.795,112.100,112.410,112.419,112.026,111.976,112.300,113.578,113.170,114.278,114.870,115.639,115.950,115.411,115.735,115.237,115.375,116.450,116.899,117.215,116.080,114.700,113.446,114.590,114.820,116.700,116.450,117.616,118.000,118.125,118.666,119.243,119.350,119.531,119.300,119.370,118.455,118.680,118.221,117.258,118.830,119.674,120.397,120.050,119.180,119.900,120.131,120.300,121.310,121.997,122.790,123.990,124.270,124.201,123.296,123.800,122.650,121.993,120.470,120.050,120.500,121.380,120.890,118.870,119.308,117.040,118.850,119.545,119.700,117.960,117.720,117.660,117.989,118.014,118.840,119.051,118.809,118.994,119.230,119.850,118.800,118.269,118.170,119.600,118.875,119.295,120.987,120.859]

    avg_premium = [22.794,22.053,21.522,21.449,22.274,22.163,21.672,21.826,21.094,21.963,23.684,22.090,21.831,22.069,22.658,22.502,22.559,22.456,22.851,22.470,21.668,20.168,21.308,24.855,25.553,26.035,30.610,29.376,28.122,31.130,29.041,28.958,28.850,27.187,26.654,24.713,24.368,24.069,22.918,23.335,22.417,21.522,21.990,21.666,20.289,19.563,20.213,20.765,20.798,21.319,21.154,20.791,21.631,21.381,25.776,24.145,22.087,22.115,21.250,20.342,20.440,21.280,22.698,22.605,22.376,21.739,22.222,22.184,22.499,24.508,23.768,23.822,25.396,24.810,22.899,22.969,24.215,24.430,24.037,22.737,23.766,22.298,21.457,21.248,20.981,21.377,21.463,20.006,20.432,20.431,20.014,18.529,18.192,19.071,19.307,19.930,19.784,20.176,22.847,21.521,21.891,21.153,19.964,19.602,20.636,21.588,22.444,21.757,23.312,23.466,25.348,30.193,29.655,32.038,29.882,30.319,29.450,28.967,29.984,27.404,28.497,27.405,29.728,33.135,32.632,31.330,30.879,33.331,31.167,30.572,30.382,30.306,31.395,32.871,32.120,31.259,29.248,28.791,28.689,29.606,29.948,29.919,30.855,33.078,34.235,36.484,34.699,36.455,34.528,32.992,30.228,31.362,31.975,32.828,34.716,33.726,32.308,33.108,32.648,32.777,30.496,29.777,30.123,31.197,31.922,32.123,30.794,32.011,32.613,32.276,34.471,33.457,32.955,31.988,32.951,34.295,32.362,31.489,31.874,29.354,29.728,29.359,30.858,29.752,32.748,32.790,32.482,40.879,41.910,43.322,45.778,44.684,47.000,43.631,38.150,39.860,40.066,40.608,40.885,43.328,41.879,40.347,39.885,36.925,36.668,35.913,36.410,36.919,37.132,33.703,32.142,32.752,31.333,30.386,29.969,32.850,32.092,31.603,36.069,36.070,35.063,33.534,36.129,34.829,31.240,30.574,31.595,33.712,33.237,34.295,32.764,31.270,30.318,33.164,33.270,33.958,34.820,33.986,34.294,32.571,33.366,33.221,34.938,34.750,34.506,35.692,33.066,32.288,32.516,32.726,33.080,32.534,32.901,32.069,32.760,33.931,33.147,31.500,32.345,32.050,31.855,33.038,33.152,34.313,35.795,36.867,33.046,31.763,30.435,29.132,29.168,29.513,27.024,26.477,26.250,26.764,24.639,21.216,20.820,20.892,20.980,20.710,19.723,19.108,18.653,17.452,20.286,17.650,16.787,18.143,19.521,18.943,18.073,18.372,18.752,18.747,18.384,18.513,19.311,18.951,19.648,18.151,15.751,15.983,15.178,14.746,15.060,14.139,13.884,14.458,14.373,14.738,12.717,11.944,12.003,11.512,12.309,12.439,11.343,13.278,13.896,16.055,15.587,20.713,19.707,20.701,21.802,19.796,20.462,21.516,20.282,19.896,22.441,22.624,21.269,21.997,24.134,24.651,22.024,21.916,21.622,21.737,21.488,21.668,22.617,22.226,24.015,22.975,20.875,21.227,20.466,22.054,21.908,21.895,20.823,19.827,19.090,19.005,19.678,20.218,19.819,21.230,19.386,18.986,19.737,19.710,19.505,21.987,21.561,22.062,21.926,21.664,21.316,20.992,20.885,22.475,22.219,24.695,23.425,22.334,22.473,22.493,22.415,22.531,23.351,23.689,25.324,26.448,29.583,30.027,29.678,30.826,29.282,29.892,29.308,29.019,28.943,26.518,26.650,26.581,26.449,26.864,27.515,25.884,25.967,26.120,27.576,25.644,25.343,24.725,24.428,24.120,22.876,22.879,23.170,22.521,21.965,23.151,23.081,22.343,22.401,22.839,22.381,23.855,25.552,24.800,26.008,25.616,24.661,24.128,24.668,23.193,24.251,25.045,25.123,26.261,26.361,25.404,25.914,25.592,25.179,23.692,25.071,25.833,26.440,25.567,25.415,25.408,26.294,26.066,26.066,28.378,28.169,28.669,28.393,29.589,28.742,27.304,28.186,27.809,28.375,27.809,27.667,27.875,28.131,27.633,27.653,27.003,26.654,25.980,25.485,25.528,25.305,25.809,26.113,25.073,24.208,23.759,23.430,22.560,23.317,24.754,23.375,23.284,22.882,22.988,22.492,22.607,21.986,21.740,21.196,20.319,21.080,20.061,19.957,18.910,19.125,19.013,19.155,19.428,18.996,20.113,20.150,22.088,27.708,30.917,29.371,28.100,26.894,25.864,26.511,25.924,26.852,26.893,24.870,24.240,24.929,24.195,23.648,23.411,23.515,23.839,23.451,27.907,24.549,24.129,22.944,21.985,22.568,25.083,22.668,24.165,25.597,26.599,29.624,30.401,33.080,33.820,34.648,34.476,34.521,34.917,36.075,35.802,39.206,40.568,41.619,36.898,35.868,33.366,32.614,31.813,32.468,31.912,32.148,34.396,34.936,35.203,35.834,35.674,36.792,38.118,38.585,40.676,43.568,41.964,39.559,38.262,34.888,34.418,34.864,35.024,33.931,34.231,33.310,32.113,30.738,30.925,31.624,32.109,31.823,30.788,30.892,30.919,30.788,29.343,28.776,28.680,28.475,28.112,27.974,27.706,27.897,28.214,28.291,28.597,27.387,26.952,26.991,26.612,26.197,25.795,25.735,25.632,23.916,23.374,22.542,22.056,20.500,20.052,18.394,16.974,17.455,15.965,15.651,16.681,18.168,18.064,16.826,16.841,16.960,17.244,19.800,19.137,18.174,17.271,17.609,17.157,15.570,15.663,15.351,15.319,17.088,17.971,19.164,19.458,19.904,18.220,17.394,17.109,18.592,19.558,18.623,17.659,17.775,19.096,18.458,17.809,18.448,18.019,17.722,18.532,18.471,18.897,17.411,18.630,20.759,19.982,18.791,18.728,19.266,18.846,18.062,18.105,19.216,18.563,20.047,19.903,20.617,20.444,21.181,19.430,17.985,18.078,18.481,19.013,18.853,20.315,21.178,22.557,25.337,23.465,25.989,26.860,25.706,25.728,26.977,24.311,21.904,22.862,21.517,21.708,20.694,21.327,22.539,23.184,24.384,22.750,22.597,21.858,21.104,20.604,20.377,20.560,22.157,22.463,22.179,22.574,21.640,21.281,21.187,21.419,21.870,21.729,24.276,25.037,25.475,24.116,23.212,23.658,23.304,24.100,23.825,26.799,26.156,26.843,26.115,27.192,27.751,28.140,27.498,27.490,28.442,29.523,31.731,30.865,32.810,32.252,33.058,32.958,31.805,30.659,30.716,30.589,30.025,30.765,32.168,32.421,30.104,30.428,29.626,29.224,29.651,30.712,31.131,30.304,30.231,29.935,30.049,28.651,26.778,26.614,26.893,26.117,26.599,26.785,25.454,26.025,25.575,25.942,25.337,26.265,28.893,31.960,29.955,30.227,31.050,29.342,29.020,29.014,29.809,28.827,29.774,29.753,29.733,28.810,29.207,30.020,29.340,28.987,28.962,28.036,27.589,28.757,28.626,29.300,30.073,28.936,29.088,27.640,27.148,27.723,27.787,27.397,27.871,27.994,28.325,28.241,28.537,29.283,29.746,30.858,32.898,33.531,32.411,32.632,31.272,32.003,32.397,32.655,32.372,32.679,32.246,31.594,31.240,31.019,31.220,30.391,29.798,30.194,30.429,29.956,29.150,29.146,28.572,28.330,29.197,29.481,29.792,29.030,28.320,27.976,27.816,27.645,27.907,28.123,27.508,27.926,27.153,28.429,28.601,27.726,27.605,27.557,28.549,28.286,28.475,28.651,30.485,30.127,30.662,30.952,30.485,30.349,30.424,31.652,32.923,34.012,35.493,34.861,34.325,33.251,33.415,33.574,34.634,34.970,33.901,33.026,32.675,32.687,33.090,33.230,34.198,33.605,34.189,34.398,33.225,33.261,33.327,34.075,34.326,34.883,34.821,34.933,35.116,34.687,33.903,33.684,33.390,33.624,33.873,33.496,34.355,33.290,32.919,32.451,32.667,32.329,33.785,34.772,34.613,36.176,35.159,33.591,33.304,33.585,32.997,32.964,34.424,34.014,34.113,34.771,35.869,36.068,35.835,36.551,38.092,39.676,38.075,37.399,38.813,38.023,37.860,38.275]


    return build_rows(date, mid_price, avg_premium)


def build_rows(date, mid_price, avg_premium):
    rows = []
    # 遍历所有行

    i = 0
    for d in date:
        p = mid_price[i]
        row = {'date': datetime.strptime(d, '%Y-%m-%d'), 'mid_price': p, 'avg_premium':avg_premium[i]}
        rows.append(row)
        i += 1
    return rows


def build_row(row, td, i):
    text = td.text.strip()
    if i == 1:
        row['date'] = datetime.strptime(text, '%Y-%m-%d')
    else:
        row['mid_price'] = text


def insert_db(rows):
    err_row = None
    try:
        i = 0
        with db_utils.get_connect() as con:
            cur = con.cursor()
            for row in rows:
                err_row = row
                result = cur.execute("""insert into cb_index_history( date, mid_price, avg_premium) values(:date, :mid_price, :avg_premium)""",
                                     {'date': row['date'], 'mid_price': row['mid_price'], 'avg_premium': row['avg_premium']})
                if result.rowcount != 1:
                    print('insert db_index is failure. row:' + row['date'])
                else:
                    i += 1

        print("insert db_index is complete. count:" + str(i))

    except Exception as e:
        # cur_file.close()
        print("db操作出现异常. err_row" + str(err_row), e)
        raise e


def update_idx_data():
    driver = get_chrome_driver("https://www.jisilu.cn/data/cbnew/cb_index/", 15)

    table = driver.find_element_by_id('table_cb_index_body')

    s = table.text
    lines = s.splitlines()
    rows = []
    for line in lines:
        ss = line.split()
        d = ss[0]
        idx_data = ss[1]

        row = {'date': d, 'idx_data': idx_data}
        rows.append(row)

    driver.close()

    err_row = None
    try:
        i = 0
        with db_utils.get_connect() as con:
            cur = con.cursor()
            for row in rows:
                err_row = row
                result = cur.execute("""update cb_index_history set idx_data = :idx_data where strftime('%Y-%m-%d', date) = :date""",
                                     {'date': row['date'], 'idx_data': row['idx_data']})
                if result.rowcount != 1:
                    print('update db_index is failure. row:' + row['date'])
                else:
                    i += 1

        print("update db_index is complete. count:" + str(i))

    except Exception as e:
        # cur_file.close()
        print("db操作出现异常. err_row" + str(err_row), e)
        raise e

def fetch_data():
    rows = get_content()
    insert_db(rows)
    return 'OK'


if __name__ == "__main__":
    # fetch_data()
    # update_idx_data()

    print("可转债数据抓取更新完成")
